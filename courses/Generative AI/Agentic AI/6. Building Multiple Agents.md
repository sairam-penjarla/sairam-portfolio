# 6. Building Multiple Agents

In the rapidly evolving landscape of AI, the ability to tackle increasingly complex tasks is paramount. While a single, powerful AI agent can accomplish much, a more sophisticated and often more effective approach is to build **multi-agent systems**. This strategy mirrors human organizations, where specialized teams collaborate under a central coordinator to achieve a grander goal.

Instead of one monolithic AI trying to do everything, we can design a network of **specialist agents**, each an expert in its domain, managed by an **orchestrator agent**. This blog post will guide you through setting up such a system, demonstrating how to define individual agents and then connect them using the concept of "handoffs."

Let's begin by defining the foundational components shared across our agents:

```python
import os
from openai import AsyncAzureOpenAI
from agents import Agent, OpenAIChatCompletionsModel, handoff
from dataclasses import dataclass

# ===== User Info Dataclass (Shared Context) =====
@dataclass
class UserInfo:
    email: str
    auth_access_token: str
    entra_id_user_id: str
    user_id: str
    session_id: str

# ===== Azure OpenAI Client (Shared LLM Access) =====
# This client will be used by all agents as their underlying "brain" for reasoning.
agent_client = AsyncAzureOpenAI(
    api_key=os.getenv("GPT_4_O_AZURE_OPENAI_API_KEY"),
    api_version=os.getenv("GPT_4_O_AZURE_OPENAI_API_VERSION"),
    azure_endpoint=os.getenv("GPT_4_O_AZURE_OPENAI_API_ENDPOINT"),
    azure_deployment=os.getenv("GPT_4_O_AZURE_OPENAI_API_MODEL_NAME"),
)

model_name = os.getenv("GPT_4_O_AZURE_OPENAI_API_MODEL_NAME")

# ===== Placeholder Tool for Creative Content Generation =====
# This is a stand-in for a real tool (like our 'generate_image' from previous blogs).
# In a full system, this would be the actual implementation.
def generate_creative_content(*args, **kwargs):
    """
    Placeholder for image/video/chart generation.
    In a real scenario, this would interact with a DALLÂ·E API, etc.
    """
    print(f"DEBUG: Creative content tool invoked with args: {kwargs}")
    return {"status": "success", "message": "Creative content generated (placeholder)"}

# ===== Load Instructions (Each agent needs its own set of rules) =====
# These markdown files contain the specific behavioral guidelines for each agent.
# (Assume these files exist in a 'prompts' directory)
with open("prompts/image_specialist_instructions.md", "r", encoding="utf-8") as f:
    image_specialist_instructions = f.read()

with open("prompts/blog_writer_instructions.md", "r", encoding="utf-8") as f:
    blog_writer_instructions = f.read()

with open("prompts/orchestrator_agent_instructions.md", "r", encoding="utf-8") as f:
    orchestrator_instructions = f.read()
```

---

### The Image & Media Creation Agent: The Visual Storyteller

Our first specialist agent is designed to handle all things visual. Whether it's generating an image, a video, or a chart, this agent is the go-to expert. Its instructions will guide it on how to interpret requests for visual content and use its designated tools.

```python
# ===== Image/Video/Chart Agent Definition =====
image_specialist_agent = Agent[UserInfo](
    name="Image & Media Creation Agent", # A descriptive name for this specialist
    instructions=image_specialist_instructions, # Its specific instructions for visual tasks
    model=OpenAIChatCompletionsModel(
        model=model_name,
        openai_client=agent_client
    ),
    tools=[generate_creative_content], # It has access to the creative content tool
)
```

- **`name`**: Clearly identifies its role.
- **`instructions`**: Loaded from `image_specialist_instructions.md`, these instructions would detail how the agent should interpret requests for visual content, refine prompts, specify image styles, sizes, and other parameters before calling the `generate_creative_content` tool.
- **`model`**: Uses the shared Azure OpenAI model as its processing brain.
- **`tools`**: It has `generate_creative_content` in its toolkit, enabling it to fulfill visual requests. This agent's expertise is entirely focused on leveraging this (and potentially other visual) tools effectively.

---

### The Blog Writer Agent: The Wordsmith

Next, we have our literary expert: the Blog Writer Agent. This agent is singularly focused on generating high-quality textual content, such as blog posts, articles, or summaries. While it might not have direct tools (like an image generation tool), its strength lies in its ability to compose coherent, engaging, and well-structured text based on its instructions and the context it receives.

```python
# ===== Blog Writer Agent Definition =====
blog_writer_agent = Agent[UserInfo](
    name="Blog Writer Agent", # Its dedicated name
    instructions=blog_writer_instructions, # Its specific instructions for writing tasks
    model=OpenAIChatCompletionsModel(
        model=model_name,
        openai_client=agent_client
    ),
    tools=[], # This agent does not have its own direct tools; it focuses on text generation.
              # In some designs, it might have tools for research or formatting.
)
```

- **`name`**: Clearly defines its role as a writer.
- **`instructions`**: Loaded from `blog_writer_instructions.md`, these would guide the agent on blog structure, tone, audience, content generation from given topics, and potentially how to integrate inputs from other agents (e.g., an image URL provided by the Image Agent).
- **`model`**: Leverages the same powerful LLM as its processing engine.
- **`tools`**: In this specific setup, it's shown with an empty `tools` list, signifying its primary function is direct text generation and understanding, rather than calling external APIs directly for tasks like image generation.
