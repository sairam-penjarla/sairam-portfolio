<script>
      const allSectionNames = {{ all_section_names | tojson | safe }};
      const allBlogsOfParticularSection = {{ all_blogs_of_particular_section | tojson | safe }};
      const latestBlogsPerSection = {{ latest_blogs_per_section | tojson | safe }};
      const blogDetails = {{ blog_details | tojson | safe }};

      // console.log("allSectionNames:", allSectionNames);
      // console.log("allBlogsOfParticularSection:", allBlogsOfParticularSection);
      // console.log("Latest Blogs Per Section:", latestBlogsPerSection);
      // console.log("Blog Details:", blogDetails);

      const container = document.getElementById("content");

      function encodeForURL(str) {
        return encodeURIComponent(str);
      }

      // Creates a single blog card element
      function createBlogCard(sectionName, post) {
        const a = document.createElement("a");
        a.className = "prompt-choose-card";
        a.href = `/prompts/${encodeForURL(sectionName)}/${encodeForURL(post.title)}`;

        const img = document.createElement("img");
        img.className = "thumb";
        img.alt = post.title;
        img.src = post.thumbnail || "";

        const content = document.createElement("div");
        content.className = "prompt-card-content";

        const title = document.createElement("h3");
        title.className = "post-title";
        title.textContent = post.title;

        const meta = document.createElement("div");
        meta.className = "meta";

        const sectionLabel = document.createElement("div");
        sectionLabel.className = "section-name";
        sectionLabel.textContent = post.createdAt || sectionName;

        const date = document.createElement("div");
        date.className = "date";
        date.textContent = post.date || "";

        meta.appendChild(sectionLabel);
        meta.appendChild(date);

        content.appendChild(title);
        content.appendChild(meta);

        a.appendChild(img);
        a.appendChild(content);

        return a;
      }

      // Renders a section heading + grid of posts
      function renderSection(sectionName, posts, showViewAll = true) {
        console.log(`Rendering section: ${sectionName}`, posts);
        if (!posts || posts.length === 0) return;

        const header = document.createElement("div");
        header.className = "prompt-section-header";

        const titleDiv = document.createElement("div");
        titleDiv.className = "heading";
        titleDiv.textContent = sectionName;
        header.appendChild(titleDiv);


        if (showViewAll) {
          const viewAll = document.createElement("a");
          viewAll.className = "view-all";
          viewAll.href = `/prompts/${encodeForURL(sectionName)}`;
          viewAll.textContent = "View all";
          header.appendChild(viewAll);
        }
        
        container.appendChild(header);

        const grid = document.createElement("div");
        grid.className = "grid";

        posts.forEach(post => {
          grid.appendChild(createBlogCard(sectionName, post));
        });

        container.appendChild(grid);
      }

      // Main logic
      if (blogDetails) {
        // Show full blog
        renderBreadcrumbs(blogDetails);
        renderBlogDetails(blogDetails)
      }
      else if (allBlogsOfParticularSection && allBlogsOfParticularSection.length > 0) {
        // Render all blogs in a section (no View All button)
        console.log("Rendering all blogs for section:", allBlogsOfParticularSection[0].slug);
        renderSection(allBlogsOfParticularSection[0].slug || "Section", allBlogsOfParticularSection, false);
      }
      else if (latestBlogsPerSection && Object.keys(latestBlogsPerSection).length > 0) {
        // Render top 3 blogs per section (with View All)
        for (const [sectionName, posts] of Object.entries(latestBlogsPerSection)) {
          renderSection(sectionName, posts.slice(0, 3), true);
        }
      }
      function renderBreadcrumbs(details) {
        const breadcrumbDiv = document.getElementById("promptBreadcrumbs");

        // Clear existing
        breadcrumbDiv.innerHTML = "";

        // Skip if no details or in mobile view
        if (!details || window.innerWidth <= 768) {
          return;
        }

        // Helper to create a breadcrumb link
        function createCrumb(label, href = null) {
          const crumb = document.createElement(href ? "a" : "span");
          crumb.textContent = label;
          crumb.className = "breadcrumb-item";
          if (href) crumb.href = href;
          return crumb;
        }

        // Add base "Prompts" link
        breadcrumbDiv.appendChild(createCrumb("Prompts", "/prompts"));

        // Add separator and subsection link
        if (details.subsection) {
          breadcrumbDiv.appendChild(document.createTextNode(" › "));
          breadcrumbDiv.appendChild(
            createCrumb(details.subsection, `/prompts/${encodeURIComponent(details.subsection)}`)
          );
        }

        // Add separator and blog title (no link)
        if (details.blog_slug) {
          breadcrumbDiv.appendChild(document.createTextNode(" › "));
          breadcrumbDiv.appendChild(createCrumb(details.blog_slug));
        }
      }

      // Example usage with blogDetails from Flask
      document.addEventListener("DOMContentLoaded", () => {
        renderBreadcrumbs(blogDetails);
      });
</script>

<style>
      .prompt-breadcrumbs {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
            padding: 10px 30px;
      }
      .prompt-breadcrumbs a {
            color: #0073e6;
            text-decoration: none;
      }
      .prompt-breadcrumbs a:hover {
            text-decoration: underline;
      }
</style>
